### PREREQUISITES ###
### STRINGMAPS ###
 add policy stringmap SM_CS_CONTROL -comment "This stringmap is used to control application flow through content switching virtual servers"
 add policy stringmap SM_VS_CONTROL -comment "This stringmap is used to control access to load balancing virtual servers"
 add policy stringmap SM_IP_CONTROL -comment "This stringmap is used to control access to load balancing virtual servers based on client IP address"

 add policy stringmap SM_PORT_PROTOCOLS -comment "This stringmap is used to create a universal redirect policy valid for http and https"
bind policy stringmap SM_PORT_PROTOCOLS 443 "proto=https;switch=http;"
bind policy stringmap SM_PORT_PROTOCOLS 80 "proto=http;switch=https;"

 add policy stringmap SM_REDIR -comment "This stringmap is used to create a universal redirect policy valid for http and https"
bind policy stringmap SM_REDIR VS_REDIR_301 "HTTP/1.1 301 Moved Permanently\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_301_SWITCH "HTTP/1.1 301 Moved Permanently\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_301_KEEPPATH "HTTP/1.1 301 Moved Permanently\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_302 "HTTP/1.1 302 Found\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_302_SWITCH "HTTP/1.1 302 Found\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_302_KEEPPATH "HTTP/1.1 302 Found\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_307 "HTTP/1.1 307 Temporary Redirect\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_307_SWITCH "HTTP/1.1 307 Temporary Redirect\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_307_KEEPPATH "HTTP/1.1 307 Temporary Redirect\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_308 "HTTP/1.1 308 Permanent Redirect\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_308_SWITCH "HTTP/1.1 308 Permanent Redirect\r\nLocation: "
bind policy stringmap SM_REDIR VS_REDIR_308_KEEPPATH "HTTP/1.1 308 Permanent Redirect\r\nLocation: "

 add policy stringmap SM_ACME -comment "This stringmap is used to control ACME challenges and responses"

### PATTERN SETS ###
 add policy patset PS_NAME_PROTOCOLS -comment "This pattern set is used to create a universal name convention per protocol for vservers"
bind policy patset PS_NAME_PROTOCOLS _HTTP -index 1
bind policy patset PS_NAME_PROTOCOLS _HTTPS -index 2
bind policy patset PS_NAME_PROTOCOLS _SSL -index 3
bind policy patset PS_NAME_PROTOCOLS _ssl -index 4
bind policy patset PS_NAME_PROTOCOLS _https -index 5
bind policy patset PS_NAME_PROTOCOLS _http -index 6
bind policy patset PS_NAME_PROTOCOLS _TCP -index 7
bind policy patset PS_NAME_PROTOCOLS _tcp -index 8
bind policy patset PS_NAME_PROTOCOLS _STCP -index 9
bind policy patset PS_NAME_PROTOCOLS _stcp -index 10
bind policy patset PS_NAME_PROTOCOLS _UDP -index 11
bind policy patset PS_NAME_PROTOCOLS _udp -index 12

### POLICY EXPRESSIONS ###
### VERSION SPECIFIC ###
### DEBUG CONTROLS ###
add policy expression PE_CL10_7_INSERT_TXID true

### TRANSACTION IDENTIFIERS ###
add policy expression PE_CL10_7_REQ_TXID HTTP.REQ.TXID.BEFORE_STR("-")
add policy expression PE_CL10_7_RES_TXID HTTP.RES.TXID.BEFORE_STR("-")

### REDIRECT PROTOCOLS ###
add policy expression PE_CL10_7_HTTP_SWITCH "CLIENT.TCP.DSTPORT.TYPECAST_TEXT_T.MAP_STRING(\"SM_PORT_PROTOCOLS\").AFTER_STR(\"switch=\").BEFORE_STR(\";\") ALT \"https\""
add policy expression PE_CL10_7_HTTP_REDIR "HTTP.REQ.LB_VSERVER.NAME.MAP_STRING(\"SM_REDIR\") ALT \"HTTP/1.1 302 Found\r\nLocation: \""
add policy expression PE_CL10_7_IS_SSL "HTTP.REQ.CS_VSERVER.NAME.ENDSWITH(\"_HTTP\").NOT" -comment "client.ssl.is_ssl does not seem to work correctly"


### RESPONDER ACTIONS ###
add responder action RSA_CL10_7_NO_SERVICE respondwith q{"HTTP/1.1 503 Service Unavailable\r\n\r\nService Unavailable\n" + HTTP.REQ.HOSTNAME + HTTP.REQ.URL}

add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED INFORMATIONAL "\"RSP_CL10_7_BLOCKED - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME.SERVER + \" - \" + HTTP.REQ.URL"
add responder action RSA_CL10_7_BLOCKED respondwith q{"HTTP/1.1 403 Forbidden\r\n\r\nBLOCKED\n" + HTTP.REQ.HOSTNAME + HTTP.REQ.URL}
add responder policy RSP_CL10_7_BLOCKED true RSA_CL10_7_BLOCKED -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED

add audit messageaction LOG_CL10_7_RSP_CL10_7_NOTFOUND_HTTP INFORMATIONAL "\"RSP_CL10_7_NOTFOUND_HTTP - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME.SERVER + \" - \" + HTTP.REQ.URL"
add responder action RSA_CL10_7_NOTFOUND_HTTP respondwith q{"HTTP/1.1 404 Not Found\r\n\r\nPage not found\n" + HTTP.REQ.HOSTNAME + HTTP.REQ.URL}
add responder policy RSP_CL10_7_NOTFOUND_HTTP true RSA_CL10_7_NOTFOUND_HTTP -logAction LOG_CL10_7_RSP_CL10_7_NOTFOUND_HTTP

add audit messageaction LOG_CL10_7_RSP_CL10_7_DROP_HTTP INFORMATIONAL "\"RSP_CL10_7_DROP_HTTP - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME.SERVER + \" - \" + HTTP.REQ.URL"
add responder policy RSP_CL10_7_DROP_HTTP true DROP -logAction LOG_CL10_7_RSP_CL10_7_DROP_HTTP

add audit messageaction LOG_CL10_7_RSP_CL10_7_DROP_TCP INFORMATIONAL "\"RSP_CL10_7_DROP_TCP - \" + CLIENT.TCP.CS_VSERVER.NAME + \" - \" + CLIENT.TCP.LB_VSERVER.NAME + \" - \" + CLIENT.TCP.DSTPORT"
add responder policy RSP_CL10_7_DROP_TCP true DROP -logAction LOG_CL10_7_RSP_CL10_7_DROP_TCP

add audit messageaction LOG_CL10_7_RSP_CL10_7_RESET_HTTP INFORMATIONAL "\"RSP_CL10_7_RESET - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME.SERVER + \" - \" + HTTP.REQ.URL"
add responder policy RSP_CL10_7_RESET_HTTP true RESET -logAction LOG_CL10_7_RSP_CL10_7_RESET_HTTP

add audit messageaction LOG_CL10_7_RSP_CL10_7_RESET_TCP INFORMATIONAL "\"RSP_CL10_7_RESET_TCP - \" + CLIENT.TCP.CS_VSERVER.NAME + \" - \" + CLIENT.TCP.LB_VSERVER.NAME + \" - \" + CLIENT.TCP.DSTPORT"
add responder policy RSP_CL10_7_RESET_TCP true RESET -logAction LOG_CL10_7_RSP_CL10_7_RESET_TCP

add audit messageaction LOG_CL10_7_REDIR_SWITCH INFORMATIONAL "\"RSP_CL10_7_REDIR_SWITCH - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME.SERVER + \" - \" + HTTP.REQ.URL"
add responder action RSA_CL10_7_REDIR_SWITCH respondwith q{PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_SWITCH + "://" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH_AND_QUERY + "\r\n\r\n"}
add responder policy RSP_CL10_7_REDIR_SWITCH true RSA_CL10_7_REDIR_SWITCH


add policy expression PE_CL10_7_HTTP_ACME_KEY "(\"domain=\" + HTTP.REQ.HOSTNAME + \";type=http-01;token=\" + HTTP.REQ.URL.PATH.GET(3))"
add policy expression PE_CL10_7_HTTP_ACME_KEY_EXISTS "(\"domain=\" + HTTP.REQ.HOSTNAME + \";type=http-01;token=\" + HTTP.REQ.URL.PATH.GET(3)).IS_STRINGMAP_KEY(\"SM_ACME\")"
add policy expression PE_CL10_7_HTTP_ACME_VALUE "(\"domain=\" + HTTP.REQ.HOSTNAME + \";type=http-01;token=\" + HTTP.REQ.URL.PATH.GET(3)).MAP_STRING(\"SM_ACME\").AFTER_STR(\"authorization=\").BEFORE_STR(\";\")"

add audit messageaction LOG_CL10_7_ACME_HTTP INFORMATIONAL "\"RSP_CL10_7_ACME_HTTP - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.HOSTNAME"
add responder action RSA_CL10_7_ACME_HTTP respondwith q{"HTTP/1.1 200 OK\r\n\r\n" + PE_CL10_7_HTTP_ACME_VALUE}
add responder policy RSP_CL10_7_ACME_HTTP "PE_CL10_7_HTTP_ACME_KEY_EXISTS" RSA_CL10_7_ACME_HTTP -logAction LOG_CL10_7_ACME_HTTP


### CONTENT SWITCHING ###
### DETECT LAN###
add policy expression PE_CL10_7_TCP_CS_IP_ISLAN_1X "(CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(19).TYPECAST_TEXT_T + \"/19\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(18).TYPECAST_TEXT_T + \"/18\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(17).TYPECAST_TEXT_T + \"/17\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(16).TYPECAST_TEXT_T + \"/16\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(15).TYPECAST_TEXT_T + \"/15\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(14).TYPECAST_TEXT_T + \"/14\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_TCP_CS_IP_ISLAN_2X_A "(CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(24).TYPECAST_TEXT_T + \"/24\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(23).TYPECAST_TEXT_T + \"/23\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(22).TYPECAST_TEXT_T + \"/22\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(21).TYPECAST_TEXT_T + \"/21\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(20).TYPECAST_TEXT_T + \"/20\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_TCP_CS_IP_ISLAN_2X_B "(CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(29).TYPECAST_TEXT_T + \"/29\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(28).TYPECAST_TEXT_T + \"/28\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(27).TYPECAST_TEXT_T + \"/27\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(26).TYPECAST_TEXT_T + \"/26\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(25).TYPECAST_TEXT_T + \"/25\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_TCP_CS_IP_ISLAN_3X "(CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.TYPECAST_TEXT_T + \"/32\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(31).TYPECAST_TEXT_T + \"/31\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(30).TYPECAST_TEXT_T + \"/30\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"

add policy expression PE_CL10_7_UDP_CS_IP_ISLAN_1X "(CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(19).TYPECAST_TEXT_T + \"/19\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(18).TYPECAST_TEXT_T + \"/18\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(17).TYPECAST_TEXT_T + \"/17\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(16).TYPECAST_TEXT_T + \"/16\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(15).TYPECAST_TEXT_T + \"/15\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(14).TYPECAST_TEXT_T + \"/14\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_UDP_CS_IP_ISLAN_2X_A "(CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(24).TYPECAST_TEXT_T + \"/24\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(23).TYPECAST_TEXT_T + \"/23\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(22).TYPECAST_TEXT_T + \"/22\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(21).TYPECAST_TEXT_T + \"/21\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(20).TYPECAST_TEXT_T + \"/20\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_UDP_CS_IP_ISLAN_2X_B "(CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(29).TYPECAST_TEXT_T + \"/29\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(28).TYPECAST_TEXT_T + \"/28\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(27).TYPECAST_TEXT_T + \"/27\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(26).TYPECAST_TEXT_T + \"/26\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(25).TYPECAST_TEXT_T + \"/25\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_UDP_CS_IP_ISLAN_3X "(CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.TYPECAST_TEXT_T + \"/32\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(31).TYPECAST_TEXT_T + \"/31\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.UDP.CS_VSERVER.NAME.BEFORE_STR_ANY(\"PS_NAME_PROTOCOLS\").TO_LOWER + \";lan;\" + CLIENT.IP.SRC.SUBNET(30).TYPECAST_TEXT_T + \"/30\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"


### ACME PROTOCOL
add policy expression PE_CL10_7_HTTP_CS_ACME_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/.well-known/acme-challenge\").TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_ACME_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/.well-known/acme-challenge\").TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\"))"
add policy expression PE_CL10_7_HTTP_CS_ACME_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/.well-known/acme-challenge\").TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"

add audit messageaction LOG_CL10_7_HTTP_CSP_ACME_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,ACME,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_ACME_ANY_KEY + "," + PE_CL10_7_HTTP_CS_ACME_ANY_VALUE_VS/

add cs action CSA_CL10_7_ACME_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_ACME_ANY_VALUE_VS
add cs policy CSP_CL10_7_ACME_ANY -rule PE_CL10_7_HTTP_CS_ACME_ANY_KEY_EXISTS -action CSA_CL10_7_ACME_ANY -logAction LOG_CL10_7_HTTP_CSP_ACME_ANY


### FULL - LAN ###
add policy expression PE_CL10_7_HTTP_CS_FULL_LAN_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FULL_LAN_KEY_EXISTS "((HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\"))"
add policy expression PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FULL_LAN INFORMATIONAL q/"CL10_7_CSP,HTTP,FULL,LAN," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FULL_LAN_KEY + "," + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FULL_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,LAN,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FULL_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,LAN,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FULL_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,LAN,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_DST/

add cs action CSA_CL10_7_FULL_LAN -targetVserverExpr PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_VS
add cs policy CSP_CL10_7_FULL_LAN -rule "(PE_CL10_7_HTTP_CS_FULL_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_FULL_LAN -logAction LOG_CL10_7_HTTP_CSP_FULL_LAN

add responder action RSA_CL10_7_REDIR_FULL_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FULL_LAN "(PE_CL10_7_HTTP_CS_FULL_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_FULL_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_FULL_LAN
add responder action RSA_CL10_7_REDIR_KEEPPATH_FULL_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FULL_LAN_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FULL_LAN "(PE_CL10_7_HTTP_CS_FULL_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_KEEPPATH_FULL_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FULL_LAN
add responder policy RSP_CL10_7_NO_SERVICE_FULL_LAN "(PE_CL10_7_HTTP_CS_FULL_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FULL_LAN

### FULL - ANY ###
add policy expression PE_CL10_7_HTTP_CS_FULL_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FULL_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + HTTP.REQ.URL.PATH).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FULL_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,FULL,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FULL_ANY_KEY + "," + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FULL_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,ANY,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FULL_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,ANY,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FULL_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FULL,ANY,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_DST/

add cs action CSA_CL10_7_FULL_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_VS
add cs policy CSP_CL10_7_FULL_ANY -rule PE_CL10_7_HTTP_CS_FULL_ANY_KEY_EXISTS -action CSA_CL10_7_FULL_ANY -logAction LOG_CL10_7_HTTP_CSP_FULL_ANY

add responder action RSA_CL10_7_REDIR_FULL_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FULL_ANY PE_CL10_7_HTTP_CS_FULL_ANY_KEY_EXISTS RSA_CL10_7_REDIR_FULL_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_FULL_ANY
add responder action RSA_CL10_7_REDIR_KEEPPATH_FULL_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FULL_ANY_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FULL_ANY PE_CL10_7_HTTP_CS_FULL_ANY_KEY_EXISTS RSA_CL10_7_REDIR_KEEPPATH_FULL_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FULL_ANY
add responder policy RSP_CL10_7_NO_SERVICE_FULL_ANY PE_CL10_7_HTTP_CS_FULL_ANY_KEY_EXISTS RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FULL_ANY

### SCND - LAN ###
add policy expression PE_CL10_7_HTTP_CS_SCND_LAN_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_SCND_LAN_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_SCND_LAN INFORMATIONAL q/"CL10_7_CSP,HTTP,SCND,LAN," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_SCND_LAN_KEY + "," + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_SCND_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,LAN,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_SCND_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,LAN,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_SCND_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,LAN,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_DST/

add cs action CSA_CL10_7_SCND_LAN -targetVserverExpr PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_VS
add cs policy CSP_CL10_7_SCND_LAN -rule "(PE_CL10_7_HTTP_CS_SCND_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_SCND_LAN -logAction LOG_CL10_7_HTTP_CSP_SCND_LAN

add responder action RSA_CL10_7_REDIR_SCND_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_SCND_LAN "(PE_CL10_7_HTTP_CS_SCND_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_SCND_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_SCND_LAN
add responder action RSA_CL10_7_REDIR_KEEPPATH_SCND_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_SCND_LAN_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_SCND_LAN "(PE_CL10_7_HTTP_CS_SCND_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_KEEPPATH_SCND_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_SCND_LAN
add responder policy RSP_CL10_7_NO_SERVICE_SCND_LAN "(PE_CL10_7_HTTP_CS_SCND_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_SCND_LAN

### SCND - ANY ###
add policy expression PE_CL10_7_HTTP_CS_SCND_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_SCND_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1) + \"/\" + HTTP.REQ.URL.PATH.GET(2)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_SCND_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,SCND,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_SCND_ANY_KEY + "," + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_SCND_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,ANY,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_SCND_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,ANY,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_SCND_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,SCND,ANY,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_DST/

add cs action CSA_CL10_7_SCND_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_VS
add cs policy CSP_CL10_7_SCND_ANY -rule PE_CL10_7_HTTP_CS_SCND_ANY_KEY_EXISTS -action CSA_CL10_7_SCND_ANY -logAction LOG_CL10_7_HTTP_CSP_SCND_ANY

add responder action RSA_CL10_7_REDIR_SCND_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_SCND_ANY PE_CL10_7_HTTP_CS_SCND_ANY_KEY_EXISTS RSA_CL10_7_REDIR_SCND_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_SCND_ANY
add responder action RSA_CL10_7_REDIR_KEEPPATH_SCND_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_SCND_ANY_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_SCND_ANY PE_CL10_7_HTTP_CS_SCND_ANY_KEY_EXISTS RSA_CL10_7_REDIR_KEEPPATH_SCND_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_SCND_ANY
add responder policy RSP_CL10_7_NO_SERVICE_SCND_ANY PE_CL10_7_HTTP_CS_SCND_ANY_KEY_EXISTS RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_SCND_ANY

### FRST - LAN ###
add policy expression PE_CL10_7_HTTP_CS_FRST_LAN_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FRST_LAN_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FRST_LAN INFORMATIONAL q/"CL10_7_CSP,HTTP,FRST,LAN," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FRST_LAN_KEY + "," + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FRST_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,LAN,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FRST_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,LAN,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FRST_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,LAN,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_DST/

add cs action CSA_CL10_7_FRST_LAN -targetVserverExpr PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_VS
add cs policy CSP_CL10_7_FRST_LAN -rule "(PE_CL10_7_HTTP_CS_FRST_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_FRST_LAN -logAction LOG_CL10_7_HTTP_CSP_FRST_LAN

add responder action RSA_CL10_7_REDIR_FRST_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FRST_LAN "(PE_CL10_7_HTTP_CS_FRST_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_FRST_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_FRST_LAN
add responder action RSA_CL10_7_REDIR_KEEPPATH_FRST_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FRST_LAN_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FRST_LAN "(PE_CL10_7_HTTP_CS_FRST_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_KEEPPATH_FRST_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FRST_LAN
add responder policy RSP_CL10_7_NO_SERVICE_FRST_LAN "(PE_CL10_7_HTTP_CS_FRST_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FRST_LAN

### FRST - ANY ###
add policy expression PE_CL10_7_HTTP_CS_FRST_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FRST_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER + \"/\" + HTTP.REQ.URL.PATH.GET(1)).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FRST_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,FRST,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FRST_ANY_KEY + "," + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FRST_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,ANY,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FRST_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,ANY,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FRST_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FRST,ANY,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_DST/

add cs action CSA_CL10_7_FRST_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_VS
add cs policy CSP_CL10_7_FRST_ANY -rule PE_CL10_7_HTTP_CS_FRST_ANY_KEY_EXISTS -action CSA_CL10_7_FRST_ANY -logAction LOG_CL10_7_HTTP_CSP_FRST_ANY

add responder action RSA_CL10_7_REDIR_FRST_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FRST_ANY PE_CL10_7_HTTP_CS_FRST_ANY_KEY_EXISTS RSA_CL10_7_REDIR_FRST_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_FRST_ANY
add responder action RSA_CL10_7_REDIR_KEEPPATH_FRST_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FRST_ANY_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FRST_ANY PE_CL10_7_HTTP_CS_FRST_ANY_KEY_EXISTS RSA_CL10_7_REDIR_KEEPPATH_FRST_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FRST_ANY
add responder policy RSP_CL10_7_NO_SERVICE_FRST_ANY PE_CL10_7_HTTP_CS_FRST_ANY_KEY_EXISTS RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FRST_ANY

# FQDN - LAN ###
add policy expression PE_CL10_7_HTTP_CS_FQDN_LAN_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FQDN_LAN_KEY_EXISTS "((HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\"))"
add policy expression PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FQDN_LAN INFORMATIONAL q/"CL10_7_CSP,HTTP,FQDN,LAN," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FQDN_LAN_KEY + "," + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FQDN_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,LAN,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FQDN_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,LAN,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FQDN_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,LAN,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_DST/

add cs action CSA_CL10_7_FQDN_LAN -targetVserverExpr PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_VS
add cs policy CSP_CL10_7_FQDN_LAN -rule "(PE_CL10_7_HTTP_CS_FQDN_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_FQDN_LAN -logAction LOG_CL10_7_HTTP_CSP_FQDN_LAN

add responder action RSA_CL10_7_REDIR_FQDN_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FQDN_LAN "(PE_CL10_7_HTTP_CS_FQDN_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_FQDN_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_FQDN_LAN
add responder action RSA_CL10_7_REDIR_KEEPPATH_FQDN_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FQDN_LAN_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FQDN_LAN "(PE_CL10_7_HTTP_CS_FQDN_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_KEEPPATH_FQDN_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FQDN_LAN
add responder policy RSP_CL10_7_NO_SERVICE_FQDN_LAN "(PE_CL10_7_HTTP_CS_FQDN_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FQDN_LAN

# FQDN - ANY ###
add policy expression PE_CL10_7_HTTP_CS_FQDN_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_FQDN_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;\" + HTTP.REQ.HOSTNAME.SERVER).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_FQDN_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,FQDN,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_FQDN_ANY_KEY + "," + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FQDN_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,ANY,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_FQDN_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,ANY,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FQDN_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,FQDN,ANY,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_DST/

add cs action CSA_CL10_7_FQDN_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_VS
add cs policy CSP_CL10_7_FQDN_ANY -rule PE_CL10_7_HTTP_CS_FQDN_ANY_KEY_EXISTS -action CSA_CL10_7_FQDN_ANY -logAction LOG_CL10_7_HTTP_CSP_FQDN_ANY

add responder action RSA_CL10_7_REDIR_FQDN_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_FQDN_ANY PE_CL10_7_HTTP_CS_FQDN_ANY_KEY_EXISTS RSA_CL10_7_REDIR_FQDN_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_FQDN_ANY
add responder action RSA_CL10_7_REDIR_KEEPPATH_FQDN_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_FQDN_ANY_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_FQDN_ANY PE_CL10_7_HTTP_CS_FQDN_ANY_KEY_EXISTS RSA_CL10_7_REDIR_KEEPPATH_FQDN_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_FQDN_ANY
add responder policy RSP_CL10_7_NO_SERVICE_FQDN_ANY PE_CL10_7_HTTP_CS_FQDN_ANY_KEY_EXISTS RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_FQDN_ANY

### WILD - LAN ###
add policy expression PE_CL10_7_HTTP_CS_WILD_LAN_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";lan;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_WILD_LAN_KEY_EXISTS "((HTTP.REQ.CS_VSERVER.NAME + \";lan;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\"))"
add policy expression PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";lan;*.\" +  HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";lan;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_WILD_LAN INFORMATIONAL q/"CL10_7_CSP,HTTP,WILD,LAN," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_WILD_LAN_KEY + "," + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_WILD_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,LAN,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_WILD_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,LAN,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_WILD_LAN INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,LAN,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_DST/

add cs action CSA_CL10_7_WILD_LAN -targetVserverExpr PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_VS
add cs policy CSP_CL10_7_WILD_LAN -rule "(PE_CL10_7_HTTP_CS_WILD_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_WILD_LAN -logAction LOG_CL10_7_HTTP_CSP_WILD_LAN

add responder action RSA_CL10_7_REDIR_WILD_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_WILD_LAN "(PE_CL10_7_HTTP_CS_WILD_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_WILD_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_WILD_LAN
add responder action RSA_CL10_7_REDIR_KEEPPATH_WILD_LAN respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_WILD_LAN_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_WILD_LAN "(PE_CL10_7_HTTP_CS_WILD_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_REDIR_KEEPPATH_WILD_LAN -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_WILD_LAN
add responder policy RSP_CL10_7_NO_SERVICE_WILD_LAN "(PE_CL10_7_HTTP_CS_WILD_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_WILD_LAN

### WILD - ANY ###
add policy expression PE_CL10_7_HTTP_CS_WILD_ANY_KEY "(HTTP.REQ.CS_VSERVER.NAME + \";any;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER"
add policy expression PE_CL10_7_HTTP_CS_WILD_ANY_KEY_EXISTS "(HTTP.REQ.CS_VSERVER.NAME + \";any;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_DST "(HTTP.REQ.CS_VSERVER.NAME + \";any;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"dst=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_VS "(HTTP.REQ.CS_VSERVER.NAME + \";any;*.\" + HTTP.REQ.HOSTNAME.DOMAIN).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add audit messageaction LOG_CL10_7_HTTP_CSP_WILD_ANY INFORMATIONAL q/"CL10_7_CSP,HTTP,WILD,ANY," + PE_CL10_7_REQ_TXID + "," + CLIENT.IP.SRC + "," + HTTP.REQ.CS_VSERVER.NAME + "," + HTTP.REQ.HOSTNAME + "," + HTTP.REQ.URL.PATH + "," + PE_CL10_7_HTTP_CS_WILD_ANY_KEY + "," + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_NO_SERVICE_WILD_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,ANY,NOSVC," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_VS/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_WILD_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,ANY,REDIR," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_DST/
add audit messageaction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_WILD_ANY INFORMATIONAL q/"CL10_7_RSP,HTTP,WILD,ANY,REDIR_KEEPPATH," + PE_CL10_7_REQ_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_DST/

add cs action CSA_CL10_7_WILD_ANY -targetVserverExpr PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_VS
add cs policy CSP_CL10_7_WILD_ANY -rule PE_CL10_7_HTTP_CS_WILD_ANY_KEY_EXISTS -action CSA_CL10_7_WILD_ANY -logAction LOG_CL10_7_HTTP_CSP_WILD_ANY

add responder action RSA_CL10_7_REDIR_WILD_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_DST + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_WILD_ANY PE_CL10_7_HTTP_CS_WILD_ANY_KEY_EXISTS RSA_CL10_7_REDIR_WILD_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_WILD_ANY
add responder action RSA_CL10_7_REDIR_KEEPPATH_WILD_ANY respondwith q/PE_CL10_7_HTTP_REDIR + PE_CL10_7_HTTP_CS_WILD_ANY_VALUE_DST + HTTP.REQ.URL.PATH + "\r\n\r\n"/
add responder policy RSP_CL10_7_REDIR_KEEPPATH_WILD_ANY PE_CL10_7_HTTP_CS_WILD_ANY_KEY_EXISTS RSA_CL10_7_REDIR_KEEPPATH_WILD_ANY -logAction LOG_CL10_7_HTTP_RSP_REDIR_KEEPPATH_WILD_ANY
add responder policy RSP_CL10_7_NO_SERVICE_WILD_ANY PE_CL10_7_HTTP_CS_WILD_ANY_KEY_EXISTS RSA_CL10_7_NO_SERVICE -logAction LOG_CL10_7_HTTP_RSP_NO_SERVICE_WILD_ANY


### TCP & UDP ###
add policy expression PE_CL10_7_TCP_LAN_KEY_EXISTS  "(CLIENT.TCP.CS_VSERVER.NAME + \";lan;tcp/\" + CLIENT.TCP.DSTPORT).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_TCP_LAN_VS  "(CLIENT.TCP.CS_VSERVER.NAME + \";lan;tcp/\" + CLIENT.TCP.DSTPORT).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_TCP_ANY_KEY_EXISTS  "(CLIENT.TCP.CS_VSERVER.NAME + \";any;tcp/\" + CLIENT.TCP.DSTPORT).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_TCP_ANY_VS  "(CLIENT.TCP.CS_VSERVER.NAME + \";any;tcp/\" + CLIENT.TCP.DSTPORT).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"

add audit messageaction LOG_CL10_7_TCP_LAN INFORMATIONAL "\"CL10_7_CSP,TCP,LAN,\" + CLIENT.IP.SRC + \",\" + CLIENT.TCP.CS_VSERVER.NAME + \",\" + CLIENT.TCP.DSTPORT.TYPECAST_TEXT_T + \",\" + PE_CL10_7_TCP_LAN_VS"
add audit messageaction LOG_CL10_7_TCP_ANY INFORMATIONAL "\"CL10_7_CSP,TCP,ANY,\" + CLIENT.IP.SRC + \",\" + CLIENT.TCP.CS_VSERVER.NAME + \",\" + CLIENT.TCP.DSTPORT.TYPECAST_TEXT_T + \",\" + PE_CL10_7_TCP_ANY_VS"

add cs action CSA_CL10_7_TCP_LAN -targetVserverExpr PE_CL10_7_TCP_LAN_VS
add cs action CSA_CL10_7_TCP_ANY -targetVserverExpr PE_CL10_7_TCP_ANY_VS

add cs policy CSP_CL10_7_TCP_LAN -rule "(PE_CL10_7_TCP_LAN_KEY_EXISTS && (PE_CL10_7_TCP_CS_IP_ISLAN_3X || PE_CL10_7_TCP_CS_IP_ISLAN_2X_B || PE_CL10_7_TCP_CS_IP_ISLAN_2X_A || PE_CL10_7_TCP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_TCP_LAN -logAction LOG_CL10_7_TCP_LAN
add cs policy CSP_CL10_7_TCP_ANY -rule PE_CL10_7_TCP_ANY_KEY_EXISTS -action CSA_CL10_7_TCP_ANY -logAction LOG_CL10_7_TCP_ANY


add policy expression PE_CL10_7_UDP_LAN_KEY_EXISTS  "(CLIENT.UDP.CS_VSERVER.NAME + \";lan;UDP/\" + CLIENT.UDP.DSTPORT).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_UDP_LAN_VS  "(CLIENT.UDP.CS_VSERVER.NAME + \";lan;UDP/\" + CLIENT.UDP.DSTPORT).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"
add policy expression PE_CL10_7_UDP_ANY_KEY_EXISTS  "(CLIENT.UDP.CS_VSERVER.NAME + \";any;UDP/\" + CLIENT.UDP.DSTPORT).TO_LOWER.IS_STRINGMAP_KEY(\"SM_CS_CONTROL\")"
add policy expression PE_CL10_7_UDP_ANY_VS  "(CLIENT.UDP.CS_VSERVER.NAME + \";any;UDP/\" + CLIENT.UDP.DSTPORT).TO_LOWER.MAP_STRING(\"SM_CS_CONTROL\").AFTER_STR(\"vs=\").BEFORE_STR(\";\")"

add audit messageaction LOG_CL10_7_UDP_LAN INFORMATIONAL "\"CL10_7_CSP,UDP,LAN,\" + CLIENT.IP.SRC + \",\" + CLIENT.UDP.CS_VSERVER.NAME + \",\" + CLIENT.UDP.DSTPORT.TYPECAST_TEXT_T + \",\" + PE_CL10_7_UDP_LAN_VS"
add audit messageaction LOG_CL10_7_UDP_ANY INFORMATIONAL "\"CL10_7_CSP,UDP,ANY,\" + CLIENT.IP.SRC + \",\" + CLIENT.UDP.CS_VSERVER.NAME + \",\" + CLIENT.UDP.DSTPORT.TYPECAST_TEXT_T + \",\" + PE_CL10_7_UDP_ANY_VS"

add cs action CSA_CL10_7_UDP_LAN -targetVserverExpr PE_CL10_7_UDP_LAN_VS
add cs action CSA_CL10_7_UDP_ANY -targetVserverExpr PE_CL10_7_UDP_ANY_VS

add cs policy CSP_CL10_7_UDP_LAN -rule "(PE_CL10_7_UDP_LAN_KEY_EXISTS && (PE_CL10_7_UDP_CS_IP_ISLAN_3X || PE_CL10_7_UDP_CS_IP_ISLAN_2X_B || PE_CL10_7_UDP_CS_IP_ISLAN_2X_A || PE_CL10_7_UDP_CS_IP_ISLAN_1X))" -action CSA_CL10_7_UDP_LAN -logAction LOG_CL10_7_UDP_LAN
add cs policy CSP_CL10_7_UDP_ANY -rule PE_CL10_7_UDP_ANY_KEY_EXISTS -action CSA_CL10_7_UDP_ANY -logAction LOG_CL10_7_UDP_ANY



### IP WHITELISTING/BLACKLISTING ###
### CONTENT SWITCHING VIRTUAL SERVERS ###
add policy expression PE_CL10_7_IP_CSTCP_IS_LISTED "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER).IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_CSTCP_IS_WHITELISTED "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER).MAP_STRING(\"SM_IP_CONTROL\").AFTER_STR(\"list=\").BEFORE_STR(\";\").EQ(\"whitelist\")"
add policy expression PE_CL10_7_IP_CSTCP_IS_BLACKLISTED "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER).MAP_STRING(\"SM_IP_CONTROL\").AFTER_STR(\"list=\").BEFORE_STR(\";\").EQ(\"blacklist\")"
add policy expression PE_CL10_7_IP_CSTCP_3X "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.TYPECAST_TEXT_T + \"/32\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(31).TYPECAST_TEXT_T + \"/31\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(30).TYPECAST_TEXT_T + \"/30\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_CSTCP_2X_B "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(29).TYPECAST_TEXT_T + \"/29\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(28).TYPECAST_TEXT_T + \"/28\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(27).TYPECAST_TEXT_T + \"/27\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(26).TYPECAST_TEXT_T + \"/26\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(25).TYPECAST_TEXT_T + \"/25\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_CSTCP_2X_A "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(24).TYPECAST_TEXT_T + \"/24\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(23).TYPECAST_TEXT_T + \"/23\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(22).TYPECAST_TEXT_T + \"/22\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(21).TYPECAST_TEXT_T + \"/21\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(20).TYPECAST_TEXT_T + \"/20\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_CSTCP_1X "(CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(19).TYPECAST_TEXT_T + \"/19\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(18).TYPECAST_TEXT_T + \"/18\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(17).TYPECAST_TEXT_T + \"/17\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(16).TYPECAST_TEXT_T + \"/16\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(15).TYPECAST_TEXT_T + \"/15\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.CS_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(14).TYPECAST_TEXT_T + \"/14\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"

add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS INFORMATIONAL "\"BLOCKED CS - \" + CLIENT.TCP.CS_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"
add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS_WHITE INFORMATIONAL "\"BLOCKED CS WHITELIST - \" + CLIENT.TCP.CS_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"
add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS_BLACK INFORMATIONAL "\"BLOCKED CS BLACKLIST - \" + CLIENT.TCP.CS_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"

add responder policy RSP_CL10_7_CSTCP_BLOCKED_NOT_LISTED "!PE_CL10_7_IP_CSTCP_IS_LISTED" RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS
add responder policy RSP_CL10_7_CSTCP_BLOCKED_WHITE "PE_CL10_7_IP_CSTCP_IS_LISTED && PE_CL10_7_IP_CSTCP_IS_WHITELISTED && !(PE_CL10_7_IP_CSTCP_3X || PE_CL10_7_IP_CSTCP_2X_B || PE_CL10_7_IP_CSTCP_2X_A || PE_CL10_7_IP_CSTCP_1X)" RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS_WHITE
add responder policy RSP_CL10_7_CSTCP_BLOCKED_BLACK "PE_CL10_7_IP_CSTCP_IS_LISTED && PE_CL10_7_IP_CSTCP_IS_BLACKLISTED && (PE_CL10_7_IP_CSTCP_3X || PE_CL10_7_IP_CSTCP_2X_B || PE_CL10_7_IP_CSTCP_2X_A || PE_CL10_7_IP_CSTCP_1X)" RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_CS_BLACK

### LOAD BALANCING VIRTUAL SERVERS ###
add policy expression PE_CL10_7_IP_VSTCP_IS_LISTED "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER).IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_VSTCP_IS_WHITELISTED "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER).MAP_STRING(\"SM_IP_CONTROL\").AFTER_STR(\"list=\").BEFORE_STR(\";\").EQ(\"whitelist\")"
add policy expression PE_CL10_7_IP_VSTCP_IS_BLACKLISTED "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER).MAP_STRING(\"SM_IP_CONTROL\").AFTER_STR(\"list=\").BEFORE_STR(\";\").EQ(\"blacklist\")"
add policy expression PE_CL10_7_IP_VSTCP_3X "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.TYPECAST_TEXT_T + \"/32\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(31).TYPECAST_TEXT_T + \"/31\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(30).TYPECAST_TEXT_T + \"/30\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_VSTCP_2X_B "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(29).TYPECAST_TEXT_T + \"/29\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(28).TYPECAST_TEXT_T + \"/28\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(27).TYPECAST_TEXT_T + \"/27\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(26).TYPECAST_TEXT_T + \"/26\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(25).TYPECAST_TEXT_T + \"/25\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_VSTCP_2X_A "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(24).TYPECAST_TEXT_T + \"/24\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(23).TYPECAST_TEXT_T + \"/23\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(22).TYPECAST_TEXT_T + \"/22\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(21).TYPECAST_TEXT_T + \"/21\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(20).TYPECAST_TEXT_T + \"/20\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"
add policy expression PE_CL10_7_IP_VSTCP_1X "(CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(19).TYPECAST_TEXT_T + \"/19\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(18).TYPECAST_TEXT_T + \"/18\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(17).TYPECAST_TEXT_T + \"/17\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(16).TYPECAST_TEXT_T + \"/16\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(15).TYPECAST_TEXT_T + \"/15\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\") || (CLIENT.TCP.LB_VSERVER.NAME.TO_LOWER + \";any;\" + CLIENT.IP.SRC.SUBNET(14).TYPECAST_TEXT_T + \"/14\").IS_STRINGMAP_KEY(\"SM_IP_CONTROL\")"

add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS INFORMATIONAL "\"BLOCKED VS - \" + CLIENT.TCP.LB_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"
add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS_WHITE INFORMATIONAL "\"BLOCKED VS WHITELIST - \" + CLIENT.TCP.LB_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"
add audit messageaction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS_BLACK INFORMATIONAL "\"BLOCKED VS BLACKLIST - \" + CLIENT.TCP.LB_VSERVER.NAME + \" - \" + CLIENT.IP.SRC"

add responder policy RSP_CL10_7_VSTCP_BLOCKED_NOT_LISTED "!PE_CL10_7_IP_VSTCP_IS_LISTED" RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS
add responder policy RSP_CL10_7_VSTCP_BLOCKED_WHITE "PE_CL10_7_IP_VSTCP_IS_LISTED && PE_CL10_7_IP_VSTCP_IS_WHITELISTED && !(PE_CL10_7_IP_VSTCP_3X || PE_CL10_7_IP_VSTCP_2X_B || PE_CL10_7_IP_VSTCP_2X_A || PE_CL10_7_IP_VSTCP_1X) " RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS_WHITE
add responder policy RSP_CL10_7_VSTCP_BLOCKED_BLACK "PE_CL10_7_IP_VSTCP_IS_LISTED && PE_CL10_7_IP_VSTCP_IS_BLACKLISTED &&(PE_CL10_7_IP_VSTCP_3X || PE_CL10_7_IP_VSTCP_2X_B || PE_CL10_7_IP_VSTCP_2X_A || PE_CL10_7_IP_VSTCP_1X) " RESET -comment "SM_IP_CONTROL Blocked" -logAction LOG_CL10_7_RSP_CL10_7_BLOCKED_VS_BLACK
add responder policy RSP_CL10_7_VSHTTP_BLOCKED_NOT_LISTED PE_CL10_7_IP_VSTCP_IS_LISTED RESET -comment "SM_IP_CONTROL Blocked"


### LOGGING MESSAGES ###
add audit messageaction LOG_CL10_7_UNAUTHORIZED INFORMATIONAL "\"UNAUTHORIZED - \" + HTTP.REQ.CS_VSERVER.NAME + \" - \" + HTTP.REQ.LB_VSERVER.NAME + \" - \" + HTTP.REQ.USER.NAME"


add audit messageaction LOG_CL10_7_CORE_TX_COMPLETE INFORMATIONAL q/"CL10_7_RWP,HTTP,OK," + PE_CL10_7_RES_TXID + "," + HTTP.REQ.LB_VSERVER.NAME + "," + SERVER.IP.SRC/
add rewrite policy RWP_CL10_7_CORE_TX_COMPLETE true NOREWRITE -logAction LOG_CL10_7_CORE_TX_COMPLETE

### REQUEST REWRITE ###
add rewrite action RWA_CL10_7_CORE_INS_X_FORWARDED_BY insert_http_header X-Forwarded-By HTTP.REQ.CS_VSERVER.NAME -comment "Inserts X-Forwarded-by; the name of the contentswitch that received the request"
add rewrite action RWA_CL10_7_CORE_INS_X_FORWARDED_FOR insert_http_header X-Forwarded-For CLIENT.IP.SRC -comment "Inserts X-Forwarded-For; the original client source ip"
add rewrite action RWA_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTP insert_http_header X-Forwarded-Proto "\"HTTP\"" -comment "Inserts X-Forwarded-Proto; HTTP = the original request was NOT offloaded"
add rewrite action RWA_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTPS insert_http_header X-Forwarded-Proto "\"HTTPS\"" -comment "Inserts X-Forwarded-Proto; HTTPS = the original request was offloaded"
add rewrite action RWA_CL10_7_CORE_DEL_ACCEPT_ENCODING delete_http_header Accept-Encoding -comment "Deletes Accept-Encoding; disables compression in the backend response"

add rewrite policy RWP_CL10_7_CORE_INS_X_FORWARDED_BY true RWA_CL10_7_CORE_INS_X_FORWARDED_BY
add rewrite policy RWP_CL10_7_CORE_INS_X_FORWARDED_FOR true RWA_CL10_7_CORE_INS_X_FORWARDED_FOR
add rewrite policy RWP_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTP "!PE_CL10_7_IS_SSL" RWA_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTP
add rewrite policy RWP_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTPS PE_CL10_7_IS_SSL RWA_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTPS
add rewrite policy RWP_CL10_7_CORE_DEL_ACCEPT_ENCODING true RWA_CL10_7_CORE_DEL_ACCEPT_ENCODING

add rewrite policylabel RWPL_CL10_7_CS_REQ_CORE http_req
bind rewrite policylabel RWPL_CL10_7_CS_REQ_CORE RWP_CL10_7_CORE_DEL_ACCEPT_ENCODING 1 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_REQ_CORE RWP_CL10_7_CORE_INS_X_FORWARDED_FOR 2 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_REQ_CORE RWP_CL10_7_CORE_INS_X_FORWARDED_BY 3 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_REQ_CORE RWP_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTPS 4 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_REQ_CORE RWP_CL10_7_CORE_INS_X_FORWARDED_PROTO_HTTP 5 NEXT

### RESPONSE REWRITE
add rewrite action RWA_CL10_7_CORE_DEL_X_ASPNET_VERSION delete_http_header X-AspNet-Version
add rewrite action RWA_CL10_7_CORE_DEL_SERVER delete_http_header Server
add rewrite action RWA_CL10_7_CORE_DEL_X_POWERED_BY delete_http_header X-Powered-By
add rewrite action RWA_CL10_7_CORE_INS_TXID insert_http_header TXID "HTTP.RES.TXID.BEFORE_STR(\"-\")"

add rewrite policy RWP_CL10_7_CORE_DEL_X_ASPNET_VERSION true RWA_CL10_7_CORE_DEL_X_ASPNET_VERSION
add rewrite policy RWP_CL10_7_CORE_DEL_SERVER true RWA_CL10_7_CORE_DEL_SERVER
add rewrite policy RWP_CL10_7_CORE_DEL_X_POWERED_BY true RWA_CL10_7_CORE_DEL_X_POWERED_BY
add rewrite policy RWP_CL10_7_CORE_INS_TXID PE_CL10_7_INSERT_TXID RWA_CL10_7_CORE_INS_TXID

 add rewrite policylabel RWPL_CL10_7_CS_RES_CORE http_res
bind rewrite policylabel RWPL_CL10_7_CS_RES_CORE RWP_CL10_7_CORE_DEL_X_ASPNET_VERSION 20 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_RES_CORE RWP_CL10_7_CORE_DEL_SERVER 21 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_RES_CORE RWP_CL10_7_CORE_DEL_X_POWERED_BY 22 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_RES_CORE RWP_CL10_7_CORE_TX_COMPLETE 23 NEXT
bind rewrite policylabel RWPL_CL10_7_CS_RES_CORE RWP_CL10_7_CORE_INS_TXID 24 NEXT

add rewrite action RWA_CL10_7_SSLOnly_INS_STRICT_TRANSPORT_SECURITY insert_http_header Strict-Transport-Security "\"max-age=157680000\""
add rewrite policy RWP_CL10_7_SSLOnly_INS_STRICT_TRANSPORT_SECURITY "PE_CL10_7_IS_SSL && !HTTP.RES.HEADER(\"Strict-Transport-Security\").EXISTS" RWA_CL10_7_SSLOnly_INS_STRICT_TRANSPORT_SECURITY

 add rewrite policylabel RWPL_CL10_7_CS_RES_SSLONLY http_res
bind rewrite policylabel RWPL_CL10_7_CS_RES_SSLONLY RWP_CL10_7_SSLOnly_INS_STRICT_TRANSPORT_SECURITY 30 NEXT


### GENERAL PURPOSE SERVERS ### 
### DEFAULT SERVERS ###
add server DUMMY 169.254.254.254

### SERVICE GROUPS ###
 add serviceGroup SG_DUMMY_HTTP HTTP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -healthMonitor NO -cltTimeout 180 -svrTimeout 360 -CKA NO -TCPB NO -CMP YES
bind serviceGroup SG_DUMMY_HTTP DUMMY 80

 add serviceGroup SG_DUMMY_TCP TCP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -healthMonitor NO -cltTimeout 180 -svrTimeout 360 -CKA NO -TCPB NO -CMP YES
bind serviceGroup SG_DUMMY_TCP DUMMY 80


### LOAD BALANCING VIRTUAL SERVERS ###
### VS_REDIR_301 - 301 Redirects ###
 add lb vserver VS_REDIR_301 HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_301 SG_DUMMY_HTTP
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301 -policyName RSP_CL10_7_REDIR_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_301 "list=blacklist;"

### VS_REDIR_301_KEEPPATH - 301 Redirects ###
 add lb vserver VS_REDIR_301_KEEPPATH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_301_KEEPPATH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_301_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_301_keeppath "list=blacklist;"

### VS_REDIR_301_SWITCH - 301 Redirects to switch protocol between HTTP/HTTPS ###
 add lb vserver VS_REDIR_301_SWITCH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_301_SWITCH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_301_SWITCH -policyName RSP_CL10_7_REDIR_SWITCH -priority 101 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_301_switch "list=blacklist;"


### VS_REDIR_302 - 302 Redirects ###
 add lb vserver VS_REDIR_302 HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_302 SG_DUMMY_HTTP
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302 -policyName RSP_CL10_7_REDIR_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_302 "list=blacklist;"

### VS_REDIR_302_KEEPPATH - 302 Redirects ###
 add lb vserver VS_REDIR_302_KEEPPATH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_302_KEEPPATH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_302_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_302_keeppath "list=blacklist;"

### VS_REDIR_302_SWITCH - 302 Redirects to switch protocol between HTTP/HTTPS ###
 add lb vserver VS_REDIR_302_SWITCH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_302_SWITCH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_302_SWITCH -policyName RSP_CL10_7_REDIR_SWITCH -priority 101 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_302_switch "list=blacklist;"

### VS_REDIR_307 - 307 Redirects ###
 add lb vserver VS_REDIR_307 HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_307 SG_DUMMY_HTTP
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307 -policyName RSP_CL10_7_REDIR_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_307 "list=blacklist;"

### VS_REDIR_307_KEEPPATH - 307 Redirects ###
 add lb vserver VS_REDIR_307_KEEPPATH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_307_KEEPPATH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_307_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_307_keeppath "list=blacklist;"

### VS_REDIR_307_SWITCH - 307 Redirects to switch protocol between HTTP/HTTPS ###
 add lb vserver VS_REDIR_307_SWITCH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_307_SWITCH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_307_SWITCH -policyName RSP_CL10_7_REDIR_SWITCH -priority 101 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_307_switch "list=blacklist;"

### VS_REDIR_308 - 308 Redirects ###
 add lb vserver VS_REDIR_308 HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_308 SG_DUMMY_HTTP
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308 -policyName RSP_CL10_7_REDIR_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_308 "list=blacklist;"

### VS_REDIR_308_KEEPPATH - 308 Redirects ###
 add lb vserver VS_REDIR_308_KEEPPATH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_308_KEEPPATH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_SCND_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_REDIR_308_KEEPPATH -policyName RSP_CL10_7_REDIR_KEEPPATH_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_308_keeppath "list=blacklist;"

### VS_REDIR_308_SWITCH - 308 Redirects to switch protocol between HTTP/HTTPS ###
 add lb vserver VS_REDIR_308_SWITCH HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_REDIR_308_SWITCH SG_DUMMY_HTTP
bind lb vserver VS_REDIR_308_SWITCH -policyName RSP_CL10_7_REDIR_SWITCH -priority 101 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_redir_308_switch "list=blacklist;"




### VS_NO_SERVICE_HTTP - Default load balancer for HTTP ###
 add lb vserver VS_NO_SERVICE_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_NO_SERVICE_HTTP SG_DUMMY_HTTP
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FRST_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_SCND_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_NO_SERVICE_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_HTTP -policyName RSP_CL10_7_REDIR_SWITCH -priority 250 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_no_service_http "list=blacklist;"


### VS_NO_SERVICE_SSL - Default load balancer for SSL ###
 add lb vserver VS_NO_SERVICE_SSL HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_NO_SERVICE_SSL SG_DUMMY_HTTP
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FULL_LAN -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_SCND_LAN -priority 101 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FRST_LAN -priority 102 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FQDN_LAN -priority 103 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_WILD_LAN -priority 104 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FULL_ANY -priority 110 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FRST_ANY -priority 111 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FRST_ANY -priority 112 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_FQDN_ANY -priority 113 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NO_SERVICE_WILD_ANY -priority 114 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_NO_SERVICE_SSL -policyName RSP_CL10_7_NOTFOUND_HTTP -priority 250 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_no_service_ssl "list=blacklist;"


### VS_NO_SERVICE_TCP - Default load balancer for SSL ###
 add lb vserver VS_NO_SERVICE_TCP TCP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_NO_SERVICE_TCP SG_DUMMY_TCP
bind lb vserver VS_NO_SERVICE_TCP -policyName RSP_CL10_7_RESET_TCP -priority 250 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_no_service_tcp "list=blacklist;"


### VS_NOTFOUND_HTTP - Default response for blocked traffic ###
 add lb vserver VS_NOTFOUND_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_NOTFOUND_HTTP SG_DUMMY_HTTP
bind lb vserver VS_NOTFOUND_HTTP -policyName RSP_CL10_7_NOTFOUND_HTTP -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_notfound_http "list=blacklist;"


### VS_BLOCKED_HTTP - Default response for blocked traffic ###
 add lb vserver VS_BLOCKED_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_BLOCKED_HTTP SG_DUMMY_HTTP
bind lb vserver VS_BLOCKED_HTTP -policyName RSP_CL10_7_BLOCKED -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_blocked_http "list=blacklist;"

### VS_DROP_HTTP - Default drop for unwanted traffic ###
 add lb vserver VS_DROP_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_DROP_HTTP SG_DUMMY_HTTP
bind lb vserver VS_DROP_HTTP -policyName RSP_CL10_7_DROP_HTTP -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_drop_http "list=blacklist;"


### VS_DROP_TCP - Default drop for unwanted traffic ###
 add lb vserver VS_DROP_TCP TCP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_DROP_TCP SG_DUMMY_TCP
bind lb vserver VS_DROP_TCP -policyName RSP_CL10_7_DROP_TCP -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_drop_tcp "list=blacklist;"


### VS_RESET_HTTP - Default reset for unwanted traffic ###
 add lb vserver VS_RESET_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_RESET_HTTP SG_DUMMY_HTTP
bind lb vserver VS_RESET_HTTP -policyName RSP_CL10_7_RESET_HTTP -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_reset_http "list=blacklist;"


### VS_RESET_TCP - Default reset for unwanted traffic ###
 add lb vserver VS_RESET_TCP TCP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_RESET_TCP SG_DUMMY_TCP
bind lb vserver VS_RESET_TCP -policyName RSP_CL10_7_RESET_TCP -priority 100 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_reset_tcp "list=blacklist;"


### VS_ACME_HTTP - ACME handler ###
 add lb vserver VS_ACME_HTTP HTTP 0.0.0.0 0 -persistenceType NONE -cltTimeout 180
bind lb vserver VS_ACME_HTTP SG_DUMMY_HTTP
bind lb vserver VS_ACME_HTTP -policyName RSP_CL10_7_ACME_HTTP -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver VS_ACME_HTTP -policyName RSP_CL10_7_NOTFOUND_HTTP -priority 101 -gotoPriorityExpression END -type REQUEST

bind policy stringmap SM_IP_CONTROL vs_acme_http "list=blacklist;"
