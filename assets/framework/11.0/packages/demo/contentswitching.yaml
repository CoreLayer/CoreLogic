name: contentswitching
sections:
  - name: trafficmanagement.contentswitching.policies
    elements:
      - name: DEMO_INIT_HTTP
        fields:
        - id: name
          data: <<prefix>>_DEMO_INIT_HTTP
        - id: expression
          data: <<core.contentswitching.appexpert.expressions.advanced.INIT_CS/name>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
      - name: DEMO_INIT_SSL
        fields:
        - id: name
          data: <<prefix>>_DEMO_INIT_SSL
        - id: expression
          data: <<core.contentswitching.appexpert.expressions.advanced.INIT_CS/name>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
      - name: DEMO_INIT_TCP
        fields:
        - id: name
          data: <<prefix>>_DEMO_INIT_TCP
        - id: expression
          data: <<core.contentswitching.appexpert.expressions.advanced.INIT_CS/name>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
      - name: DEMO_INIT_SSLTCP
        fields:
        - id: name
          data: <<prefix>>_DEMO_INIT_SSLTCP
        - id: expression
          data: <<core.contentswitching.appexpert.expressions.advanced.INIT_CS/name>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
      - name: DEMO_INIT_UDP
        fields:
        - id: name
          data: <<prefix>>_DEMO_INIT_UDP
        - id: expression
          data: <<core.contentswitching.appexpert.expressions.advanced.INIT_CS/name>>
        expressions:
          install: add cs policy <<name>> -rule q{<<expression>>}
          uninstall: rm cs policy <<name>>
  - name: trafficmanagement.contentswitching.virtualservers
    elements:
      - name: DEMO_HTTP
        fields:
        - id: name
          data: <<prefix>>_DEMO_HTTP
        - id: ipaddress
          data: 169.254.254.251
        - id: policy
          data: <<demo.contentswitching.trafficmanagement.contentswitching.policies.DEMO_INIT_HTTP/name>>
        - id: policylabel
          data: <<core.contentswitching.trafficmanagement.contentswitching.policylabels.INIT_HTTP/name>>
        expressions:
          install: |
            add cs vserver <<name>> HTTP <<ipaddress>> * -Listenpriority 15 -Listenpolicy "CLIENT.IP.DSTPORT.EQ(80)"
            bind cs vserver <<name>> -policyName <<policy>> -priority 101 -gotoPriorityExpression NEXT -invoke policylabel <<policylabel>>
          uninstall: |
            rm cs vserver <<name>>
      - name: DEMO_SSL
        fields:
        - id: name
          data: <<prefix>>_DEMO_SSL
        - id: ipaddress
          data: 169.254.254.251
        - id: policy
          data: <<demo.contentswitching.trafficmanagement.contentswitching.policies.DEMO_INIT_SSL/name>>
        - id: policylabel
          data: <<core.contentswitching.trafficmanagement.contentswitching.policylabels.INIT_HTTP/name>>
        expressions:
          install: |
            add cs vserver <<name>> SSL <<ipaddress>> * -Listenpriority 25 -Listenpolicy "CLIENT.IP.DSTPORT.EQ(443)"
            bind cs vserver <<name>> -policyName <<policy>> -priority 101 -gotoPriorityExpression NEXT -invoke policylabel <<policylabel>>
          uninstall: |
            rm cs vserver <<name>>
      - name: DEMO_TCP
        fields:
        - id: name
          data: <<prefix>>_DEMO_TCP
        - id: ipaddress
          data: 169.254.254.251
        - id: policy
          data: <<demo.contentswitching.trafficmanagement.contentswitching.policies.DEMO_INIT_TCP/name>>
        - id: policylabel
          data: <<core.contentswitching.trafficmanagement.contentswitching.policylabels.INIT_TCP/name>>
        expressions:
          install: |
            add cs vserver <<name>> TCP <<ipaddress>> * -Listenpriority 35 -Listenpolicy "CLIENT.IP.DSTPORT.EQ(110)"
            bind cs vserver <<name>> -policyName <<policy>> -priority 101 -gotoPriorityExpression NEXT -invoke policylabel <<policylabel>>
          uninstall: |
            rm cs vserver <<name>>
      - name: DEMO_SSLTCP
        fields:
        - id: name
          data: <<prefix>>_DEMO_SSLTCP
        - id: ipaddress
          data: 169.254.254.251
        - id: policy
          data: <<demo.contentswitching.trafficmanagement.contentswitching.policies.DEMO_INIT_SSLTCP/name>>
        - id: policylabel
          data: <<core.contentswitching.trafficmanagement.contentswitching.policylabels.INIT_TCP/name>>
        expressions:
          install: |
            add cs vserver <<name>> SSL_TCP <<ipaddress>> * -Listenpriority 45 -Listenpolicy "CLIENT.IP.DSTPORT.EQ(993)"
            bind cs vserver <<name>> -policyName <<policy>> -priority 101 -gotoPriorityExpression NEXT -invoke policylabel <<policylabel>>
          uninstall: |
            rm cs vserver <<name>>
      - name: DEMO_UDP
        fields:
        - id: name
          data: <<prefix>>_DEMO_UDP
        - id: ipaddress
          data: 169.254.254.251
        - id: policy
          data: <<demo.contentswitching.trafficmanagement.contentswitching.policies.DEMO_INIT_UDP/name>>
        - id: policylabel
          data: <<core.contentswitching.trafficmanagement.contentswitching.policylabels.INIT_UDP/name>>
        expressions:
          install: |
            add cs vserver <<name>> UDP <<ipaddress>> * -Listenpriority 55 -Listenpolicy "CLIENT.IP.DSTPORT.EQ(993)"
            bind cs vserver <<name>> -policyName <<policy>> -priority 101 -gotoPriorityExpression NEXT -invoke policylabel <<policylabel>>
          uninstall: |
            rm cs vserver <<name>>